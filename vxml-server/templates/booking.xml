<?xml version="1.0" encoding="UTF-8"?>
<vxml version="2.1" xmlns="http://www.w3.org/2001/vxml"
      xmlns:voxeo="http://community.voxeo.com/xmlns/vxml" application="lab1.xml">

      
      <link next="lab1.xml">
   <grammar type="application/srgs+xml" root="root" version="1.0">
     <rule id="root" scope="public">start over</rule>
  </grammar>
 </link>
      
      
      <!-- State machine -->
  <form id="welcome">
    <block>
      <prompt>
        <break time="1000"/>
        Hello there! Welcome to the flight booking service!
      </prompt>
      <goto next="#askFrom"/>
    </block>
  </form>

  <!-- disable bargein for this dialog -->
  <property name="bargein" value="false"/>
      <!-- Origin -->
        <form id="askFrom">
          <field name="fromField">
            <prompt>
      	      <break time="1000" />
              What city are you leaving from? The options are london, paris or new york.
            </prompt>
            <option>london</option>
            <option>paris</option>
            <option>new york</option>

      	     <nomatch>
               <break time="1000" />
      	       Sorry, that city is not among the available options.
      	       <reprompt/>
      	     </nomatch>

            <assign name="from" expr="fromField" />
            <filled>
            	<prompt>
                <break time="1000" />
      	        Ok, from <value expr="fromField">.
             	</prompt>
            </filled>

             <goto next="#askTo" />

         </field>
         </form>


      <!-- Destination -->
        <form id="askTo">
          <field name="toField">
            <prompt>
              <break time="1000" />
              Where are you going? The options are london, paris or new york.
            </prompt>
            <option>london</option>
            <option>paris</option>
            <option>new york</option>

      	<nomatch>
          <break time="1000" />
      	  Sorry, that city is not among the available options.
      	  <reprompt/>
      	</nomatch>
              <filled>
              <assign name="to" expr="toField" />
            <if cond="to == from">
            <prompt>
                Your destination is the same as your origin. Try again.
            </prompt>
            <clear namelist="to"/>
            <reprompt/>
            <else/>
            <goto next="#askDate" />
            </if>
      	<prompt>
          <break time="1000" />
      	  Ok, to <value expr="toField">.
      	</prompt>
            </filled>
         </field>
        </form>

      <!-- Date of departure origin-->
        <form id="askDate">
          <field name="Date">
            <prompt>
              <break time="1000" />
      	What date do you want to leave?
            </prompt>
            <option>monday</option>
            <option>tuesday</option>
            <option>wednesday</option>
            <option>thursday</option>
            <option>friday</option>
            <option>saturday</option>
            <option>sunday</option>

              <nomatch>
                <break time="1000" />
      	  Sorry, that date is not among the available options.
      	  <reprompt/>
      	</nomatch>

                <assign name="Date" expr="askDate" />
            <filled>
      	      <prompt>
                <break time="1000" />
                Ok, on <value expr="askDate">
              </prompt>
              <goto next="#askOneway" />
               </filled>
          </field>
         </form>

      <!-- One way trip -->
        <form id="askOneWay">
          <field name="Oneway">
            <prompt>
      	<break time="1000" />
      	Is it a one way trip?
            </prompt>
            <option>yes</option>
            <option>no</option>
          </field>
            <filled>

            <assign name="Oneway" expr="askOneway" />
            <if cond="Oneway=='yes'"/>
              <goto next="#askConfirmOneway"/>
            <else/>
              <goto next="#askReturn"/>
            </if>
           </filled>

        </form>

      <!-- Confirm one way -->
        <form id="askConfirmOneway">
          <field name="ConfirmOneway">
          <assign name="to" expr="toField" />
          <assign name="Date" expr="askDate" />
          <filled>
            <prompt>
              <break time="1000" />
              Ok, do you want to go from <value expr="fromField"> to <value expr="toField"> on <value expr="askDate">?
            </prompt>
          </filled>

            <option>yes</option>
            <option>no</option>

             <nomatch>
               <break time="1000" />
      	      Sorry, I didn't hear you.
      	      <reprompt/>
      	     </nomatch>

             if cond="ConfirmOneway=='no'"/>
               <goto next="#fromField"/>
             <else/>
             <filled>
              <prompt>
               <break time="1000" />
              Ok, your flight has been booked from <value expr="fromField"> to <value expr="toField"> on <value expr="askDate">. Thank you for using our service.
              </prompt>
             </filled>
             </if>
          </field>
        </form>

      <!-- Return date -->
        <form id="askReturn">
          <field name="ReturnDate">
            <assign name="ReturnDate" expr="askReturn" />
            <prompt>
              <break time="1000" />
              What date do you want to return?
            </prompt>
            <option>monday</option>
            <option>tuesday</option>
            <option>wednesday</option>
            <option>thursday</option>
            <option>friday</option>
            <option>saturday</option>
            <option>sunday</option>

             <nomatch>
               <break time="1000" />
               Sorry, that date is not among the available options.
               <reprompt/>
             </nomatch>
           <filled>
            <prompt>
                  <break time="1000" />
                  Ok, do you want to go from <value expr="toField"> to <value expr="fromField"> on <value expr="askReturn">?
            </prompt>
          <option>yes</option>
          <option>no</option>
          <if cond="ReturnDate=='no'"/>
            <goto next="#fromField"/>
          <else/>
           <prompt>
            <break time="1000" />
            Your flight has been booked! Thank you for using our service.
           </prompt>
          </if>
                  </filled>



      </field>
      </form>

      </vxml>
